<!-- login.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <script>
      (function () {
        // localStorageì—ì„œ ì €ì¥ëœ í…Œë§ˆë¥¼ í™•ì¸
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          // <html> íƒœê·¸ì— data-theme="dark" ì†ì„± ì¶”ê°€
          document.documentElement.dataset.theme = "dark";
        } else {
          // ê¸°ë³¸ê°’ì€ 'light'
          document.documentElement.dataset.theme = "light";
        }
      })();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WORKBASE</title>

    <link rel="stylesheet" href="../styles/common.css" />
    <link rel="stylesheet" href="../styles/login.css" />
    <link rel="stylesheet" href="../styles/window-control.css" />
    <link rel="stylesheet" href="../styles/tooltip.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    
    <!-- Firebase SDKë¥¼ CDNì—ì„œ ë¡œë“œ (ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ IndexedDB ì ‘ê·¼ ê°€ëŠ¥) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script>
      // Firebase ì´ˆê¸°í™” (ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ì–´ IndexedDB ì ‘ê·¼ ê°€ëŠ¥)
      const firebaseConfig = {
        apiKey: "AIzaSyCwkXiJRp1DHoiv1IWnR42Y9xI5IE0_2uE",
        authDomain: "workbear-aaecb.firebaseapp.com",
        databaseURL: "https://workbear-aaecb-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "workbear-aaecb",
        storageBucket: "workbear-aaecb.appspot.com",
        messagingSenderId: "744723448261",
        appId: "1:744723448261:web:897a77a06e481f3c750bac",
      };
      
      // Firebase ì´ˆê¸°í™”
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      
      // Local persistence ì„¤ì •
      auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(() => {
        console.log("âœ… Firebase Auth (ë Œë”ëŸ¬) persistenceê°€ localë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }).catch((error) => {
        console.error("âŒ Firebase Auth persistence ì„¤ì • ì‹¤íŒ¨:", error);
      });
      
      // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
      window.firebaseAuth = auth;
      console.log("ğŸ”¥ Firebaseê°€ ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
    </script>
  </head>

  <body>
    <div class="window-control" style="border-bottom: none">
      <div class="left"></div>
      <div class="right">
        <div
          class="mode-toggle-button"
          id="mode-toggle-button"
          style="margin-right: 16px"
          data-tooltip="í…Œë§ˆ ì „í™˜"
          data-direction="bottom"
        >
          <svg class="icon" style="width: 16px">
            <use href="#icon-dark-mode"></use>
          </svg>
        </div>
        <div class="window-control-button" id="window-minimize">
          <svg class="icon" style="width: 12px">
            <use href="#icon-minimize"></use>
          </svg>
        </div>
        <div class="window-control-button" id="window-maximize">
          <svg class="icon" style="width: 12px">
            <use href="#icon-maximize"></use>
          </svg>
        </div>
        <div class="window-control-button" id="window-close">
          <svg class="icon"><use href="#icon-close"></use></svg>
        </div>
      </div>
    </div>

    <div class="login-body">
      <div class="login-container">
        <div class="left">
          <video class="video" autoplay loop muted>
            <source
              src="../../../assets/video/login-video.mp4"
              type="video/mp4"
            />
          </video>

          <div class="video-overlay-text">
            <div class="logo">
              <img src="../../../assets/image/logo.png" />
              <h2>WORKBASE</h2>
            </div>
          </div>
        </div>
        <div class="right">
          <div class="video-overlay-text">
            <div class="logo">
              <img src="../../../assets/image/logo.png" />
              <h2>WORKBASE</h2>
            </div>
          </div>
          <div class="login-wrap">
            <div class="login-title">
              <h1>ë¡œê·¸ì¸</h1>
              <h3 style="opacity: 0.6; white-space: nowrap">
                ë¡œê·¸ì¸ í›„ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </h3>
            </div>
            <form class="login-form">
              <div class="input-field-wrapper">
                <input
                  class="login-input-id"
                  type="text"
                  id="userid"
                  placeholder=" "
                />
                <label for="userid" class="placeholder-id">ì•„ì´ë””</label>
              </div>

              <div class="input-field-wrapper">
                <input
                  class="login-input-pw"
                  type="password"
                  id="userpw"
                  placeholder=" "
                />
                <label for="userpw" class="placeholder-pw">ë¹„ë°€ë²ˆí˜¸</label>
                <div
                  class="pw-toggle-icon"
                  id="pw-toggle-button"
                  data-tooltip="ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€"
                  data-direction="bottom"
                >
                  <svg class="icon" style="width: 15px">
                    <use href="#icon-hidden-eye"></use>
                  </svg>
                </div>
              </div>
              <div class="autologin-button">
                <div class="checkbox active">
                  <svg class="icon" style="width: 12px">
                    <use href="#icon-check"></use>
                  </svg>
                </div>
                <span>ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
              </div>
              <button type="submit" class="login-button" id="login-button">
                <span>ë¡œê·¸ì¸</span>
              </button>
            </form>
            <button
              type="button"
              class="cancel-button"
              id="goto-join-button"
              style="margin-top: -16px"
            >
              <span>íšŒì›ê°€ì…</span>
            </button>
          </div>

          <div class="join-wrap">
            <div class="login-title">
              <h1>íšŒì›ê°€ì…</h1>
              <h3 style="opacity: 0.6; white-space: nowrap">
                íšŒì›ê°€ì… í›„ í•˜ë£¨ë¥¼ ê¸°ë¡í•˜ê³  ê¸°ì–µí•´ ë³´ì„¸ìš”.
              </h3>
            </div>
            <form class="login-form">
              <div class="input-field-wrapper">
                <input
                  class="login-input-id"
                  type="text"
                  id="join-userid"
                  placeholder=" "
                />
                <label for="join-userid" class="placeholder-id"
                  >ì•„ì´ë””(ì´ë©”ì¼)</label
                >
              </div>

              <div class="input-field-wrapper">
                <input
                  class="login-input-pw"
                  type="password"
                  id="join-userpw"
                  placeholder=" "
                />
                <label for="userpw" class="placeholder-pw">ë¹„ë°€ë²ˆí˜¸</label>
                <div
                  class="pw-toggle-icon"
                  id="pw-toggle-button"
                  data-tooltip="ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€"
                  data-direction="bottom"
                >
                  <svg class="icon" style="width: 15px">
                    <use href="#icon-hidden-eye"></use>
                  </svg>
                </div>
              </div>

              <div class="input-field-wrapper">
                <input
                  class="login-input-pw"
                  type="password"
                  id="join-userpw-confirm"
                  placeholder=" "
                />
                <label for="join-userpw" class="placeholder-pw"
                  >ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label
                >
                <div
                  class="pw-toggle-icon"
                  id="pw-toggle-button"
                  data-tooltip="ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€"
                  data-direction="bottom"
                >
                  <svg class="icon" style="width: 15px">
                    <use href="#icon-hidden-eye"></use>
                  </svg>
                </div>
              </div>

              <div class="input-field-wrapper">
                <input
                  class="login-input-id"
                  type="text"
                  id="join-username"
                  placeholder=" "
                />
                <label for="join-username" class="placeholder-id">ì´ë¦„(ë‹‰ë„¤ì„)</label>
              </div>

              <button type="submit" class="login-button" id="join-button">
                <span>íšŒì›ê°€ì…</span>
              </button>
              <button
                type="submit"
                class="cancel-button"
                id="backto-login-button"
              >
                <span>ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div id="alert-popup" class="alert-popup">
      <div class="alert-content">
        <div class="left">
          <div class="alert-icon">
            <svg>
              <use href="#icon-caution"></use>
            </svg>
          </div>
        </div>
        <div class="right">
          <div class="alert-title">ì•Œë¦¼</div>
          <div id="alert-message" class="alert-message"></div>
        </div>
      </div>
    </div>

    <div id="check-popup" class="alert-popup">
      <div class="alert-content">
        <div class="left">
          <div class="alert-icon-check">
            <svg>
              <use href="#icon-check"></use>
            </svg>
          </div>
        </div>
        <div class="right">
          <div class="alert-title">ì•Œë¦¼</div>
          <div id="check-message" class="alert-message"></div>
        </div>
      </div>
    </div>

    <script src="../js/login.js"></script>
    <script src="../js/tooltip.js"></script>

    <script>
      // âœ… window-control.js ë¡œë“œ
      const script = document.createElement("script");
      script.src = "../js/window-control.js";
      document.body.appendChild(script);

      fetch("../../../assets/icons/icons.svg")
        .then((res) => res.text())
        .then((data) => {
          document.body.insertAdjacentHTML("afterbegin", data);
        })
        .catch((err) => console.error("SVG ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err));

      initTooltip();
    </script>
  </body>
</html>
